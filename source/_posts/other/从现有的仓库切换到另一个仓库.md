---
title: 从现有git仓库切换到另一个仓库
date: 2025-11-25 21:51:08
tags:
 - git
categories: git
---

## 从现有仓库切换到另一个仓库

### 方法一：添加新的远程仓库

此方法会**保留**原有的 `origin`（指向 `url1`），同时**新增**一个指向 `url2` 的远程仓库。这样本地仓库就可以同时与两个远程仓库进行通信。

<!-- more -->

#### 步骤 1：检查本地仓库配置

```bash
git remote -v
```

预期输出类似：

```bash
origin  url1 (fetch)
origin  url1 (push)
```

#### 步骤 2：添加新的远程仓库

为新的仓库 `url2` 指定名称，例如 `new_origin`：

```bash
git remote add new_origin url2
```

> **注意：** 将 `new_origin` 替换为自定义名称，将 `url2` 替换为新仓库的实际 URL。

#### 步骤 3：验证配置

再次执行 `git remote -v`，确认两个远程仓库均已配置：

```bash
$ git remote -v
new_origin  url2 (fetch)
new_origin  url2 (push)
origin      url1 (fetch)
origin      url1 (push)
```

#### 步骤 4：推送代码到新仓库

将代码推送到新的远程仓库 (`new_origin`)：

**推送当前分支（如 `main` 或 `master`）：**

```bash
# 假设主分支为 'main'
git push new_origin main
```

**推送所有本地分支：**

```bash
git push new_origin --all
```

**推送所有标签：**

```bash
git push new_origin --tags
```

**设置默认上游分支：**

若希望未来在 `main` 分支执行 `git push` 时默认推送到 `new_origin`：

```bash
# -u 参数表示 --set-upstream，将本地 main 分支关联到 new_origin/main
git push -u new_origin main
```

### 方法二：修改现有 `origin` 配置

如果**不再需要 `url1`**，只需将 `origin` 指向 `url2`，可采用此方法。

#### 步骤 1：修改 `origin` 的 URL

```bash
git remote set-url origin url2
```

#### 步骤 2：验证修改

执行 `git remote -v`，确认 `origin` 已指向 `url2`：

```bash
$ git remote -v
origin  url2 (fetch)
origin  url2 (push)
```

#### 步骤 3：推送代码

常规推送操作将自动指向 `url2`：

```bash
# 推送 main 分支并设置追踪
git push -u origin main

# 推送所有分支
git push --all

# 推送所有标签
git push --tags
```

### `git status` 显示机制说明

**`git status` 命令仅比较「本地工作目录」与「本地 Git 仓库的最后一次提交」之间的差异。**

该命令**不会**检查远程仓库状态，无论远程仓库为空、过时还是新仓库。

执行 `git status` 时，Git 在本地进行以下比较：

1. **工作目录**：实际可见且可编辑的文件
2. **本地快照 (HEAD)**：最后一次 `git commit` 时存储的版本

"modified" 状态表示：工作目录中的文件与最后一次提交的版本存在差异。

此过程**完全在本地完成**，无需网络连接，也不涉及远程仓库通信。

后续提交操作会将所有本地提交推送到远程仓库。

### 确定主分支的方法

#### 方法一：检查当前所在分支

执行 `git branch` 查看所有本地分支列表：

```bash
$ git branch
  feature-A
* main
  hotfix-123
```

- 标有星号 `*` 的分支（示例中为 `main`）为**当前所在分支**
- 在未主动切换分支的情况下，当前分支通常为主分支

#### 方法二：检查远程仓库默认分支

此方法显示配置的 `origin` 仓库自身认定的默认分支。

执行 `git remote show origin`：

```bash
$ git remote show origin
* remote origin
  Fetch URL: url2
  Push  URL: url2
  HEAD branch: master  <---- 默认分支标识
  Remote branches:
    main tracked
  Local branch configured for 'git pull':
    main merges with remote main
  Local ref configured for 'git push':
    main pushes to main (up to date)
```

查看 `HEAD branch:` 行显示的名称（示例中为 `master`），此为远程仓库的默认分支，通常即为主分支。

```bash
* remote origin
  Fetch URL: http://xxx.git
  Push  URL: http://xxx.git
  HEAD branch: (unknown)
  Remote branch:
    refs/remotes/origin/master stale (use 'git remote prune' to remove)
  Local branch configured for 'git pull':
    master merges with remote master
```

`HEAD branch: (unknown)` 表示新仓库中**不存在任何分支**，Git 无法确定默认分支。

从输出信息可确认**本地主分支为 `master`**：

1. `Remote branch: ... origin/master stale`：表示本地曾追踪名为 `origin/master` 的分支（来自 `url1`）
2. `Local branch configured for 'git pull': master merges with remote master`：明确显示本地存在 `master` 分支

将**本地 `master` 分支**推送到**空的远程仓库 `origin`**：

```bash
git push -u origin master
```

此命令执行两个操作：

1. `git push origin master`：将本地 `master` 分支的所有提交推送到 `origin`（即 `url2`）
2. `-u`（或 `--set-upstream`）：建立追踪关系，配置本地 `master` 分支与 `origin/master` 的对应关系