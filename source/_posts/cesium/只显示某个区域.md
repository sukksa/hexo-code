---
title: 仅显示某个行政区划（cesium 挖孔）
date: 2025-11-25 14:14:39
tags:
 - cesium
categories: cesium
---



添加polygon, 中间挖孔, 仅显示某个区域

GeoJSON为 GeoJSON , [行政区划下载](https://datav.aliyun.com/portal/school/atlas/area_selector)

<!-- more -->

```js
  // 3.1. 定义一个矩形作为遮罩的“外环”, 大致覆盖整个中国
  // 格式：[lng, lat, lng, lat, ...]
  const worldRectangle = [73.5, 4.5, 73.5, 53.5, 135.5, 53.5, 135.5, 4.5]

  // 3.2. 从 lt.json 中提取理塘县的边界作为“孔洞”
  // lt.json 是一个 FeatureCollection，我们获取第一个 feature
  const litangFeature = (GeoJSON as any).features[0]
  const litangPolygons = litangFeature.geometry.coordinates
  console.log(litangPolygons)
  // 3.3. 创建遮罩多边形的层级
  // Cesium 的 PolygonHierarchy 需要一个外环和一组内环（孔洞）
  const holes: Cesium.PolygonHierarchy[] = []
  let holeCoords: number[] = []
  // lt.json 是 MultiPolygon，所以需要遍历它包含的每一个 Polygon
  litangPolygons.forEach((polygon: number[][][]) => {
    // 每个 Polygon 又是环的数组（第一个是外环，后面是内环）
    // 在我们的遮罩中，理塘的*所有*环都是孔洞
    polygon.forEach((ring: number[][]) => {
      // Cesium.Cartesian3.fromDegreesArray 需要一个扁平的 [lng, lat, lng, lat, ...] 数组
      holeCoords = ring.flat()
      holes.push(new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(holeCoords)))
    })
  })
  // 3.4. 创建最终的遮罩层级
  const maskHierarchy = new Cesium.PolygonHierarchy(
    Cesium.Cartesian3.fromDegreesArray(worldRectangle), // 全球外环
    holes // 理塘县孔洞
  )
  // 3.5. 将遮罩添加到地球上
  viewer.entities.add({
    name: 'Litang Mask',
    polygon: {
      hierarchy: maskHierarchy,
      perPositionHeight: false,
      // material: Cesium.Color.fromCssColorString('#071B32'),
      material: '/bg.png',
      // material: 'https://p8.itc.cn/images01/20200723/b48a6c775c944f7d89043ab8e0154197.jpeg',
      // fill: true, // 默认
      // outline: false, // 默认
    },
  })
```

> `Array.prototype.flat()` [flat()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/flat) 创建一个新的数组，并根据指定深度递归地将所有子数组元素拼接到新的数组中。
>
> ```js
> const arr2 = [0, 1, [2, [3, [4, 5]]]];
> 
> console.log(arr2.flat());
> // expected output: Array [0, 1, 2, Array [3, Array [4, 5]]]
> 
> console.log(arr2.flat(2));
> // expected output: Array [0, 1, 2, 3, Array [4, 5]]
> 
> console.log(arr2.flat(Infinity));
> // expected output: Array [0, 1, 2, 3, 4, 5]
> ```
>
> 

限制camera视角范围

遍历GeoJSON获取边界矩形, 返回 `new  Cesium.Rectangle(west, south, east, north)` 

```javascript
const getLitangBoundingBox = (geoJson: any): Cesium.Rectangle => {
  let minLng = 180,
    minLat = 90,
    maxLng = -180,
    maxLat = -90

  // 遍历 lt.json 的坐标
  const polygons = geoJson.features[0].geometry.coordinates
  polygons.forEach((polygon: number[][][]) => {
    polygon.forEach((ring: number[][]) => {
      ring.forEach((point: number[]) => {
        const lng = point[0]
        const lat = point[1]
        minLng = Math.min(minLng, lng)
        maxLng = Math.max(maxLng, lng)
        minLat = Math.min(minLat, lat)
        maxLat = Math.max(maxLat, lat)
      })
    })
  })
  return Cesium.Rectangle.fromDegrees(minLng, minLat, maxLng, maxLat)
}
```

 初始化时, camera定位到该区域

```javascript
  const MAX_ALTITUDE = 500000 // 500km (最远)
  const MIN_ALTITUDE = 1000 // 1km (最近)
  
  // 将地球背景和天空盒设置为透明
  viewer.scene.backgroundColor = Cesium.Color.TRANSPARENT
  viewer.scene.globe.baseColor = Cesium.Color.TRANSPARENT

  viewer._cesiumWidget._creditContainer.style.display = 'none'
  viewer.scene.globe.depthTestAgainstTerrain = false

  // --- 设置相机缩放和倾斜限制 ---
  viewer.scene.screenSpaceCameraController.minimumZoomDistance = MIN_ALTITUDE
  viewer.scene.screenSpaceCameraController.maximumZoomDistance = MAX_ALTITUDE
  viewer.scene.screenSpaceCameraController.enableTilt = false // 2D 模式下禁止倾斜
  
  //  设置camera
  const litangBoundsDeg = getLitangBoundingBox(GeoJSON)
  viewer.camera.setView({
    destination: litangBoundsDeg,
  })
```

